<?php

function getLanguage() {
    if (isset($_GET['ln']))
    {
        $lc = $_GET['ln'];
    }
    else
    {
        if (isset($_COOKIE['mylang']))
        {
            $lc = $_COOKIE['mylang'];
        } else {
            $lc = 'autoselect';
        }
    }

    switch($lc)
    {
        case 'am_HY':
        case 'am':
        case 'hy':
            $lc = 'am_HY';
            break;
        case 'ru_RU':
        case 'ru':
            $lc = 'ru_RU';
            break;
        case 'en_EN':
        case 'en':
            $lc = 'en_EN';
            break;
        default:
            $lc = 'ru_RU'; //$lc = 'am_HY';
        
            if (isset($_SERVER['REMOTE_ADDR'])) {
                require_once('ip_in_range.php');
            
                $ip = $_SERVER['REMOTE_ADDR'];
            
                //http://api.ipinfodb.com/v3/ip-city/?key=8b3a801c9e1c4706892f31b6e4021d1ff69bfa61cbc5cccb7443310a41853c0b&ip=95.211.217.68
            
                $checkips = array(
                    //Manualy added
                    '46.19.96.0-46.19.103.255',
                    '92.43.137.0-92.43.137.255',
                    '91.103.63.0-91.103.63.255',
                    '91.103.24.0-91.103.31.255',
                    '91.204.190.0-91.204.190.255',
                    '91.210.40.0-91.210.43.255',
                    '91.220.124.0-91.220.124.255',
                    '93.94.222.0-93.94.222.255',
                    '93.187.163.0-93.187.163.255',
                    '93.187.166.0-93.187.166.255',
                    '130.193.120.0-130.193.127.255',
                    //////////////////////////////////
                    '5.77.128.0-5.77.255.255',
                    '37.157.208.0-37.157.223.255',
                    '37.252.64.0-37.252.95.255',
                    '46.70.0.0-46.71.255.255',
                    '46.130.0.0-46.130.255.255',
                    '46.162.192.0-46.162.255.255',
                    '46.241.128.0-46.241.255.255',
                    '62.89.0.0-62.89.31.255',
                    '78.109.64.0-78.109.79.255',
                    '80.86.224.0-80.86.239.255',
                    '81.16.0.0-81.16.15.255',
                    '81.89.208.0-81.89.223.255',
                    '82.199.192.0-82.199.223.255',
                    '83.139.0.0-83.139.63.255',
                    '87.241.128.0-87.241.191.255',
                    '89.249.192.0-89.249.207.255',
                    '93.185.32.0-93.185.47.255',
                    '94.228.16.0-94.228.31.255',
                    '95.140.192.0-95.140.207.255',
                    '109.75.32.0-109.75.47.255',
                    '141.136.64.0-141.136.95.255',
                    '178.72.128.0-178.72.191.255',
                    '178.78.128.0-178.78.191.255',
                    '178.160.128.0-178.160.255.255',
                    '178.219.48.0-178.219.63.255',
                    '188.115.192.0-188.115.255.255',
                    '195.250.64.0-195.250.95.255',
                    '212.34.224.0-212.34.255.255',
                    '212.42.192.0-212.42.223.255',
                    '212.73.64.0-212.73.95.255',
                    '217.63.96.0-217.63.127.255',
                    '217.76.0.0-217.76.15.255',
                    '217.113.0.0-217.113.15.255',
                    '217.113.16.0-217.113.31.255'
                );

                foreach ($checkips as $range) {
                    $ok = ip_in_range($ip, $range);
                    if($ok) {
                        $lc = 'am_HY';
                        break;
                    }
                }
            }
    }

    global $isSocial;

    $isSocial = ($_SERVER["HTTP_USER_AGENT"] == "facebookexternalhit/1.1 (+http://www.facebook.com/externalhit_uatext.php)");

    if($isSocial) {
        $lc = 'am_HY';
    }
    
    return $lc;
}